<stix:STIX_Package xmlns:cyboxVocabs="http://cybox.mitre.org/default_vocabularies-2" xmlns:indicator="http://stix.mitre.org/Indicator-2" xmlns:cyboxCommon="http://cybox.mitre.org/common-2" xmlns:FileObj="http://cybox.mitre.org/objects#FileObject-2" xmlns:stixCommon="http://stix.mitre.org/common-1" xmlns:URIObj="http://cybox.mitre.org/objects#URIObject-2" xmlns:marking="http://data-marking.mitre.org/Marking-1" xmlns:tlpMarking="http://data-marking.mitre.org/extensions/MarkingStructure#TLP-1" xmlns:stixVocabs="http://stix.mitre.org/default_vocabularies-1" xmlns:cybox="http://cybox.mitre.org/cybox-2" xmlns:stix="http://stix.mitre.org/stix-1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:CISCP="http://www.us-cert.gov/ciscp" id="CISCP:IB-13-10820" version="1.1.1" xsi:schemaLocation="http://cybox.mitre.org/objects#DomainNameObject-1 http://cybox.mitre.org/XMLSchema/objects/Domain_Name/1.0/Domain_Name_Object.xsd http://cybox.mitre.org/objects#PortObject-2 http://cybox.mitre.org/XMLSchema/objects/Port/2.1/Port_Object.xsd http://cybox.mitre.org/common-2 http://cybox.mitre.org/XMLSchema/common/2.1/cybox_common.xsd http://cybox.mitre.org/objects#WinRegistryKeyObject-2 http://cybox.mitre.org/XMLSchema/objects/Win_Registry_Key/2.1/Win_Registry_Key_Object.xsd http://stix.mitre.org/default_vocabularies-1 http://stix.mitre.org/XMLSchema/default_vocabularies/1.1.1/stix_default_vocabularies.xsd http://cybox.mitre.org/objects#FileObject-2 http://cybox.mitre.org/XMLSchema/objects/File/2.1/File_Object.xsd http://data-marking.mitre.org/Marking-1 http://stix.mitre.org/XMLSchema/data_marking/1.1.1/data_marking.xsd http://cybox.mitre.org/objects#SocketAddressObject-1 http://cybox.mitre.org/XMLSchema/objects/Socket_Address/1.1/Socket_Address_Object.xsd http://stix.mitre.org/common-1 http://stix.mitre.org/XMLSchema/common/1.1.1/stix_common.xsd http://data-marking.mitre.org/extensions/MarkingStructure#TLP-1 http://stix.mitre.org/XMLSchema/extensions/marking/tlp/1.1.1/tlp_marking.xsd http://stix.mitre.org/stix-1 http://stix.mitre.org/XMLSchema/core/1.1.1/stix_core.xsd http://cybox.mitre.org/objects#LinkObject-1 http://cybox.mitre.org/XMLSchema/objects/Link/1.1/Link_Object.xsd http://cybox.mitre.org/objects#AddressObject-2 http://cybox.mitre.org/XMLSchema/objects/Address/2.1/Address_Object.xsd http://cybox.mitre.org/default_vocabularies-2 http://cybox.mitre.org/XMLSchema/default_vocabularies/2.1/cybox_default_vocabularies.xsd http://cybox.mitre.org/objects#URIObject-2 http://cybox.mitre.org/XMLSchema/objects/URI/2.1/URI_Object.xsd http://stix.mitre.org/Indicator-2 http://stix.mitre.org/XMLSchema/indicator/2.1.1/indicator.xsd http://cybox.mitre.org/objects#EmailMessageObject-2 http://cybox.mitre.org/XMLSchema/objects/Email_Message/2.1/Email_Message_Object.xsd http://data-marking.mitre.org/extensions/MarkingStructure#Simple-1 http://stix.mitre.org/XMLSchema/extensions/marking/simple/1.1.1/simple_marking.xsd http://cybox.mitre.org/objects#MutexObject-2 http://cybox.mitre.org/XMLSchema/objects/Mutex/2.1/Mutex_Object.xsd http://cybox.mitre.org/objects#NetworkConnectionObject-2 http://cybox.mitre.org/XMLSchema/objects/Network_Connection/2.1/Network_Connection_Object.xsd http://us-cert.gov/ciscp http://www.us-cert.gov/sites/default/files/STIX_Namespace/ciscp_vocab_v1.1.1.xsd http://cybox.mitre.org/objects#HTTPSessionObject-2 http://cybox.mitre.org/XMLSchema/objects/HTTP_Session/2.1/HTTP_Session_Object.xsd http://cybox.mitre.org/cybox-2 http://cybox.mitre.org/XMLSchema/core/2.1/cybox_core.xsd">
  <stix:STIX_Header>
    <stix:Title>Web Compromise and Web Shell Files Analyzed</stix:Title>
    <stix:Package_Intent xsi:type="stixVocabs:PackageIntentVocab-1.0">Indicators</stix:Package_Intent>
    <stix:Description>On 21 November 2013 a compromised web server was discovered. Files were submitted for analysis as a result of this website defacement attack. One file contained the initial dropper which installed a web shell and defaced the web page.</stix:Description>
    <stix:Handling>
      <marking:Marking>
        <marking:Controlled_Structure>//node()</marking:Controlled_Structure>
        <marking:Marking_Structure color="GREEN" xsi:type="tlpMarking:TLPMarkingStructureType"/>
      </marking:Marking>
    </stix:Handling>
    <stix:Information_Source>
      <stixCommon:Time>
        <cyboxCommon:Produced_Time>2013-12-09T17:21:47Z</cyboxCommon:Produced_Time>
      </stixCommon:Time>
    </stix:Information_Source>
  </stix:STIX_Header>
  <stix:Indicators>
    <stix:Indicator id="CISCP:indicator-cfc9266e-0fd3-4221-8d74-7f211bc3e76b" version="2.1.1" xsi:type="indicator:IndicatorType">
      <indicator:Composite_Indicator_Expression operator="OR">
        <indicator:Indicator idref="CISCP:indicator-16771cb4-5bca-424f-b9a6-bdcc02b294ed"/>
        <indicator:Indicator idref="CISCP:indicator-f666197c-6d85-4dad-a136-6f1bb0d9a187"/>
        <indicator:Indicator idref="CISCP:indicator-68e329af-01cf-4c52-9123-83c8ed4f21c7"/>
        <indicator:Indicator idref="CISCP:indicator-5d370e1c-33d1-4c6a-a955-175b6de5c54d"/>
        <indicator:Indicator idref="CISCP:indicator-43e420c0-e4bf-4ad7-b370-d525f1330561"/>
      </indicator:Composite_Indicator_Expression>
    </stix:Indicator>
    <stix:Indicator id="CISCP:indicator-16771cb4-5bca-424f-b9a6-bdcc02b294ed" version="2.1.1" xsi:type="indicator:IndicatorType">
      <indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">Malware Artifacts</indicator:Type>
      <indicator:Description>This is an obfuscated PHP file. When executed on a PHP server, it is capable of performing 3 actions:

1. deb parameter set to "ngok"
This action will create an upload form, enabling a user or attacker to upload a file to the directory where this file is found.

2. deb parameter set to "face"
This action will drop two distinct files which are identified as file (MD5: 9c5b32e7ca965fe9d77ef999472006d6) and file (MD5: 48278223fb182c09bdb50e515a79eed5). File (MD5: 9c5b32e7ca965fe9d77ef999472006d6) is the main defaced page that visitors will see, while file (MD5: 48278223fb182c09bdb50e515a79eed5) is the web shell that can be used by the attacker(s). The contents of file (MD5: 48278223fb182c09bdb50e515a79eed5) is downloaded from "http[:]//host[.]deb-x.org/wso.txt" in order to reduce the size of this file.

3. deb parameter set to "patch"
This action will open or create a ".htaccess" file in the parent directory. It will overwrite the file with the content "deny from all". This Apache directive will deny access to this directory for all users.</indicator:Description>
      <indicator:Observable id="CISCP:Observable-864b0813-4c49-45fa-b16b-285a9274c418">
        <cybox:Object id="CISCP:Object-970f69d3-e307-417c-8c92-01d65675a687">
          <cybox:Properties xsi:type="FileObj:FileObjectType">
            <FileObj:File_Name condition="Equals">ngok.php</FileObj:File_Name>
            <FileObj:Size_In_Bytes condition="Equals">2256</FileObj:Size_In_Bytes>
            <FileObj:Hashes>
              <cyboxCommon:Hash>
                <cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">MD5</cyboxCommon:Type>
                <cyboxCommon:Simple_Hash_Value condition="Equals">f2929ff946b9bed6c32d33fc85358c72</cyboxCommon:Simple_Hash_Value>
              </cyboxCommon:Hash>
              <cyboxCommon:Hash>
                <cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">SHA1</cyboxCommon:Type>
                <cyboxCommon:Simple_Hash_Value condition="Equals">9a4dd1923daa84110bd09b4f688c3956e9643445</cyboxCommon:Simple_Hash_Value>
              </cyboxCommon:Hash>
              <cyboxCommon:Hash>
                <cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">SSDEEP</cyboxCommon:Type>
                <cyboxCommon:Fuzzy_Hash_Value condition="Equals">48:hv5231DkMwA+/oy9UCEEREt8ZUgWn99wDdSbE5/zDSLv:r2FjwHZDEEREteUg+CDsY56j</cyboxCommon:Fuzzy_Hash_Value>
              </cyboxCommon:Hash>
            </FileObj:Hashes>
          </cybox:Properties>
        </cybox:Object>
      </indicator:Observable>
      <indicator:Kill_Chain_Phases>
        <stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Actions on Objectives" ordinality="7" phase_id="stix:KillChainPhase-786ca8f9-2d9a-4213-b38e-399af4a2e5d6"/>
      </indicator:Kill_Chain_Phases>
      <indicator:Sightings sightings_count="1">
        <indicator:Sighting timestamp="2013-11-21T00:00:00"/>
      </indicator:Sightings>
    </stix:Indicator>
    <stix:Indicator id="CISCP:indicator-f666197c-6d85-4dad-a136-6f1bb0d9a187" version="2.1.1" xsi:type="indicator:IndicatorType">
      <indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">Malware Artifacts</indicator:Type>
      <indicator:Description>This is a version of the defaced page with no JavaScript or exploits.</indicator:Description>
      <indicator:Observable id="CISCP:Observable-7f54a298-0964-446b-b7bd-152cc113a160">
        <cybox:Object id="CISCP:Object-ce7fd667-502d-4aff-9688-f77b139b13cc">
          <cybox:Properties xsi:type="FileObj:FileObjectType">
            <FileObj:File_Name condition="Equals">ganteng.htm</FileObj:File_Name>
            <FileObj:Size_In_Bytes condition="Equals">2161</FileObj:Size_In_Bytes>
            <FileObj:Hashes>
              <cyboxCommon:Hash>
                <cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">MD5</cyboxCommon:Type>
                <cyboxCommon:Simple_Hash_Value condition="Equals">9c5b32e7ca965fe9d77ef999472006d6</cyboxCommon:Simple_Hash_Value>
              </cyboxCommon:Hash>
              <cyboxCommon:Hash>
                <cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">SHA1</cyboxCommon:Type>
                <cyboxCommon:Simple_Hash_Value condition="Equals">4b603fbac4ddb03b5bd2acd073a7b65d4916ba36</cyboxCommon:Simple_Hash_Value>
              </cyboxCommon:Hash>
              <cyboxCommon:Hash>
                <cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">SSDEEP</cyboxCommon:Type>
                <cyboxCommon:Fuzzy_Hash_Value condition="Equals">48:p1ldwXjF5f6Q32hyLNTjYt0gW/Vwieg/j:p1l6xp6w2hYNTjYt0gKGQ/j</cyboxCommon:Fuzzy_Hash_Value>
              </cyboxCommon:Hash>
            </FileObj:Hashes>
          </cybox:Properties>
        </cybox:Object>
      </indicator:Observable>
      <indicator:Kill_Chain_Phases>
        <stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Actions on Objectives" ordinality="7" phase_id="stix:KillChainPhase-786ca8f9-2d9a-4213-b38e-399af4a2e5d6"/>
      </indicator:Kill_Chain_Phases>
      <indicator:Sightings sightings_count="1">
        <indicator:Sighting timestamp="2013-11-21T00:00:00"/>
      </indicator:Sightings>
    </stix:Indicator>
    <stix:Indicator id="CISCP:indicator-68e329af-01cf-4c52-9123-83c8ed4f21c7" version="2.1.1" xsi:type="indicator:IndicatorType">
      <indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">Malware Artifacts</indicator:Type>
      <indicator:Description>This is an obfuscated PHP file. When executed on a PHP server, it is capable of determining the operating system it is running from, and creating a web shell to match.

When navigating to this page on a php server, the user will be presented with a screen asking for a password. The password is MD5 hashed and compared with a hardcoded password hash "335628b154666834079b64e2357c0cfb". The password for this hash is "d3b" (without quotations). Successful login will set a cookie on the client computer for authentication persistence.

After successfully logging into the web shell, the user will be presented with an interface that is capable of the following capabilities:

1. Determine server information (Computer name, Current User, Current User Group, PHP Safe Mode status, Hard drive status, Currently mounted drives, Apache version, OpenSSL version, PHP version, Currently loaded Apache modules, Disabled PHP functions, cURL support, Databases supported, Operating System and version, Account policy information, List of user accounts).

2. File system explorer (Create file, create directory, view, download, upload, modify, chmod, execute file)

3. Console/Reverse shell

4. SQL Browser (Connection types accepted are MySQL and PostgreSQL)

5. PHP Console (to execute additional PHP code)

6. String and password tool. Available commands are: Base64 Encode, Base64 Decode, URL Encode, URL Decode, MD5 hash, SHA1 hash, crypt, CRC32, ASCII to HEX, HEX to ASCII, HEX to DEC, HEX to BIN, DEC to HEX, DEC to BIN, BIN to HEX, BIN to DEC, String to lower, String to upper, htmlspecialchars. It is also capable of performing a string search on the file system, and performs a quick hash look up on hashcracking[.]ru, md5[.]rednoize.com, and crackfor[.]me.

7. Bruteforce a service password given a username. Supported services are FTP, MySQL, and PostgreSQL.

8. Create a backdoor on a *nix system by binding /bin/sh to a port.

9. Deletes itself</indicator:Description>
      <indicator:Observable id="CISCP:Observable-6004235c-1a05-4852-a940-0800561e6a81">
        <cybox:Object id="CISCP:Object-bb11a7e5-2392-4f85-8eaf-10a12aaf0c2d">
          <cybox:Properties xsi:type="FileObj:FileObjectType">
            <FileObj:File_Name condition="Equals">pacce.php</FileObj:File_Name>
            <FileObj:Size_In_Bytes condition="Equals">24929</FileObj:Size_In_Bytes>
            <FileObj:Hashes>
              <cyboxCommon:Hash>
                <cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">MD5</cyboxCommon:Type>
                <cyboxCommon:Simple_Hash_Value condition="Equals">48278223fb182c09bdb50e515a79eed5</cyboxCommon:Simple_Hash_Value>
              </cyboxCommon:Hash>
              <cyboxCommon:Hash>
                <cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">SHA1</cyboxCommon:Type>
                <cyboxCommon:Simple_Hash_Value condition="Equals">005d28999fd1854da6afa8f5f2e9be0f25d9f7e2</cyboxCommon:Simple_Hash_Value>
              </cyboxCommon:Hash>
              <cyboxCommon:Hash>
                <cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">SSDEEP</cyboxCommon:Type>
                <cyboxCommon:Fuzzy_Hash_Value condition="Equals">384:0Snj/SHl3vuprySEVTv0zxhbgPrVdSKMnIq3q+mrh8ETCvbvM8zns4E8W:vCByGXVbAbw7SKcbarhdTgbvM8zs4E8W</cyboxCommon:Fuzzy_Hash_Value>
              </cyboxCommon:Hash>
            </FileObj:Hashes>
          </cybox:Properties>
        </cybox:Object>
      </indicator:Observable>
      <indicator:Kill_Chain_Phases>
        <stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Actions on Objectives" ordinality="7" phase_id="stix:KillChainPhase-786ca8f9-2d9a-4213-b38e-399af4a2e5d6"/>
      </indicator:Kill_Chain_Phases>
      <indicator:Sightings sightings_count="1">
        <indicator:Sighting timestamp="2013-11-21T00:00:00"/>
      </indicator:Sightings>
    </stix:Indicator>
    <stix:Indicator id="CISCP:indicator-5d370e1c-33d1-4c6a-a955-175b6de5c54d" version="2.1.1" xsi:type="indicator:IndicatorType">
      <indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">Malware Artifacts</indicator:Type>
      <indicator:Description>This is a version of the defaced page with no JavaScript or exploits.</indicator:Description>
      <indicator:Observable id="CISCP:Observable-d1b93f59-1544-4cca-bc04-2be5b64769b6">
        <cybox:Object id="CISCP:Object-a8236bdd-5516-4879-9972-86869632fc9d">
          <cybox:Properties xsi:type="FileObj:FileObjectType">
            <FileObj:File_Name condition="Equals">index.php</FileObj:File_Name>
            <FileObj:Size_In_Bytes condition="Equals">1731</FileObj:Size_In_Bytes>
            <FileObj:Hashes>
              <cyboxCommon:Hash>
                <cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">MD5</cyboxCommon:Type>
                <cyboxCommon:Simple_Hash_Value condition="Equals">7314acf4b876712bb5279c5fb33525dc</cyboxCommon:Simple_Hash_Value>
              </cyboxCommon:Hash>
              <cyboxCommon:Hash>
                <cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">SHA1</cyboxCommon:Type>
                <cyboxCommon:Simple_Hash_Value condition="Equals">9cc00cf95ee627ae7ef1dc62b1cc29ea02433f8d</cyboxCommon:Simple_Hash_Value>
              </cyboxCommon:Hash>
              <cyboxCommon:Hash>
                <cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">SSDEEP</cyboxCommon:Type>
                <cyboxCommon:Fuzzy_Hash_Value condition="Equals">24:hPI/Z2bihL07AH0+Fv7+Us5767aENUB8txR8oSY3HGWASwm+WkBtxYh1NUT:tN4AsUmrC65o8XR8oS0Gyz+WOyrY</cyboxCommon:Fuzzy_Hash_Value>
              </cyboxCommon:Hash>
            </FileObj:Hashes>
          </cybox:Properties>
        </cybox:Object>
      </indicator:Observable>
      <indicator:Kill_Chain_Phases>
        <stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Actions on Objectives" ordinality="7" phase_id="stix:KillChainPhase-786ca8f9-2d9a-4213-b38e-399af4a2e5d6"/>
      </indicator:Kill_Chain_Phases>
      <indicator:Sightings sightings_count="1">
        <indicator:Sighting timestamp="2013-11-21T00:00:00"/>
      </indicator:Sightings>
    </stix:Indicator>
    <stix:Indicator id="CISCP:indicator-43e420c0-e4bf-4ad7-b370-d525f1330561" version="2.1.1" xsi:type="indicator:IndicatorType">
      <indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">URL Watchlist</indicator:Type>
      <indicator:Description>The malware will call out to this URL to download additional files if instructed to do so by the attacker.</indicator:Description>
      <indicator:Observable id="CISCP:Observable-a8c86a73-3efd-442b-86ec-81576fb516bd">
        <cybox:Object id="CISCP:Object-f6aaa002-c0b1-430d-97bf-f0576e46723a">
          <cybox:Properties type="URL" xsi:type="URIObj:URIObjectType">
            <URIObj:Value condition="Equals">http://host.deb-x.org/wso.txt</URIObj:Value>
          </cybox:Properties>
        </cybox:Object>
      </indicator:Observable>
      <indicator:Kill_Chain_Phases>
        <stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Actions on Objectives" ordinality="7" phase_id="stix:KillChainPhase-786ca8f9-2d9a-4213-b38e-399af4a2e5d6"/>
      </indicator:Kill_Chain_Phases>
      <indicator:Sightings sightings_count="1">
        <indicator:Sighting timestamp="2013-11-21T00:00:00"/>
      </indicator:Sightings>
    </stix:Indicator>
  </stix:Indicators>
  <stix:TTPs>
    <stix:Kill_Chains>
      <stixCommon:Kill_Chain definer="LMCO" id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" name="LM Cyber Kill Chain" number_of_phases="7" reference="http://www.lockheedmartin.com/content/dam/lockheed/data/corporate/documents/LM-White-Paper-Intel-Driven-Defense.pdf">
        <stixCommon:Kill_Chain_Phase name="Reconnaissance" ordinality="1" phase_id="stix:KillChainPhase-af1016d6-a744-4ed7-ac91-00fe2272185a"/>
        <stixCommon:Kill_Chain_Phase name="Weaponization" ordinality="2" phase_id="stix:KillChainPhase-445b4827-3cca-42bd-8421-f2e947133c16"/>
        <stixCommon:Kill_Chain_Phase name="Delivery" ordinality="3" phase_id="stix:KillChainPhase-79a0e041-9d5f-49bb-ada4-8322622b162d"/>
        <stixCommon:Kill_Chain_Phase name="Exploitation" ordinality="4" phase_id="stix:KillChainPhase-f706e4e7-53d8-44ef-967f-81535c9db7d0"/>
        <stixCommon:Kill_Chain_Phase name="Installation" ordinality="5" phase_id="stix:KillChainPhase-e1e4e3f7-be3b-4b39-b80a-a593cfd99a4f"/>
        <stixCommon:Kill_Chain_Phase name="Command and Control" ordinality="6" phase_id="stix:KillChainPhase-d6dc32b9-2538-4951-8733-3cb9ef1daae2"/>
        <stixCommon:Kill_Chain_Phase name="Actions on Objectives" ordinality="7" phase_id="stix:KillChainPhase-786ca8f9-2d9a-4213-b38e-399af4a2e5d6"/>
      </stixCommon:Kill_Chain>
    </stix:Kill_Chains>
  </stix:TTPs>
</stix:STIX_Package>
